---
/**
 * Stars.astro
 * CSS만으로 별이 박힌 밤하늘과 반짝이는 효과를 구현합니다.
 */

// 유성 설정: 개수와 랜덤 데이터 생성
const METEOR_COUNT = 4;
const meteors = Array.from({ length: METEOR_COUNT }).map(() => ({
  top: (Math.random() * 80 + 10) + "%", // 10% ~ 90% (화면 안쪽 목적지)
  left: (Math.random() * 80 + 10) + "%", // 10% ~ 90% (화면 안쪽 목적지)
  duration: (Math.random() * 2 + 1.5) + "s", 
  delay: (Math.random() * 25 + 2) + "s",  
}));
---
<div id="star-container" class="stars-container fixed inset-0 -z-10 bg-black overflow-hidden pointer-events-none transform-gpu">
  {/* 배경의 반짝이는 별들 */}
  {Array.from({ length: 120 }).map((_, i) => {
    const size = Math.random() * 1.5 + 0.5;
    const left = Math.random() * 100;
    const top = Math.random() * 100;
    const duration = Math.random() * 3 + 2;
    const delay = Math.random() * 5;
    
    return (
      <div 
        class="star" 
        style={`
          width: ${size}px; 
          height: ${size}px; 
          left: ${left}%; 
          top: ${top}%; 
          --twinkle-duration: ${duration}s;
          animation-delay: ${delay}s;
        `}
      />
    );
  })}
  
  {/* 왼쪽 위에서 오른쪽 아래로 떨어지는 궤적 유성들 */}
  {meteors.map((m) => (
    <div 
      class="meteor" 
      style={`
        top: ${m.top}; 
        left: ${m.left}; 
        animation-duration: ${m.duration};
        animation-delay: ${m.delay};
      `}
    />
  ))}
</div>

<style>
  /* 성능 최적화를 위한 힌트 제공 */
  .stars-container {
    will-change: transform;
    height: 150vh;
    top: 0;
  }
</style>

<script>
  // 클라이언트 사이드에서 패럴랙스 로직 실행
  const container = document.getElementById('star-container');
  
  if (container) {
    let lastScrollY = window.scrollY;
    let ticking = false;
    
    // 패럴랙스 강도 (0.1 ~ 0.2 권장)
    const PARALLAX_SPEED = 0.1; 

    const updateParallax = () => {
      // 표준적인 패럴랙스: 스크롤을 내릴 때 배경이 천천히 위로 올라감
      const translateY = -(lastScrollY * PARALLAX_SPEED);
      container.style.transform = `translate3d(0, ${translateY}px, 0)`;
      ticking = false;
    };

    const onScroll = () => {
      lastScrollY = window.scrollY;
      if (!ticking) {
        window.requestAnimationFrame(updateParallax);
        ticking = true;
      }
    };

    window.addEventListener('scroll', onScroll, { passive: true });
  }
</script>
